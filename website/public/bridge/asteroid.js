!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).asteroid=e()}}(function(){return function(){return function e(t,n,r){function o(u,s){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!s&&c)return c(u,!0);if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[u]={exports:{}};t[u][0].call(f.exports,function(e){return o(t[u][1][e]||e)},f,f.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}}()({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createClass=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[i,s,a,u,c].concat(e),n=function(){var e=this,n=arguments;t.forEach(function(t){var r=t.init;return r&&r.apply(e,n)})};return(n.prototype=Object.create(o.default.prototype)).constructor=n,r.default.apply(void 0,[n.prototype].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))),delete n.prototype.init,n};var r=l(e("lodash.assign")),o=l(e("wolfy87-eventemitter")),i=f(e("./base-mixins/ddp")),u=f(e("./base-mixins/login")),s=f(e("./base-mixins/methods")),c=f(e("./base-mixins/password-login")),a=f(e("./base-mixins/subscriptions"));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}},{"./base-mixins/ddp":2,"./base-mixins/login":3,"./base-mixins/methods":4,"./base-mixins/password-login":5,"./base-mixins/subscriptions":6,"lodash.assign":15,"wolfy87-eventemitter":16}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.connect=function(){this.ddp.connect()},n.disconnect=function(){this.ddp.disconnect()},n.init=function(e){var t=this,n=e.endpoint,r=e.SocketConstructor,o=void 0===r?WebSocket:r,u=e.autoConnect,s=e.autoReconnect,c=e.reconnectInterval;this.endpoint=n;var a={endpoint:n,SocketConstructor:o,autoConnect:u,autoReconnect:s,reconnectInterval:c};this.ddp=new i.default(a).on("connected",function(){return t.emit("connected")}).on("disconnected",function(){return t.emit("disconnected")})};var r,o=e("ddp.js"),i=(r=o)&&r.__esModule?r:{default:r}},{"ddp.js":11}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.login=function(e){return this.call("login",e).then(r.onLogin.bind(this))},n.logout=function(){return this.call("logout").then(r.onLogout.bind(this))},n.init=function(){this.userId=null,this.loggedIn=!1,this.ddp.on("connected",r.resumeLogin.bind(this))};var r=e("../common/login-method")},{"../common/login-method":8}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.apply=function(e,t){var n=this;return new Promise(function(r,o){var i=n.ddp.method(e,t);n.methods.cache[i]={resolve:r,reject:o}})},n.call=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.apply(e,n)},n.init=function(){var e=this;this.methods={cache:{}},this.ddp.on("result",function(t){var n=t.id,r=t.error,o=t.result,i=e.methods.cache[n];r?i.reject(r):i.resolve(o),delete e.methods.cache[n]})}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createUser=function(e){var t=e.username,n=e.email,o={password:e.password,user:{username:t,email:n}};return this.call("createUser",o).then(r.onLogin.bind(this))},n.loginWithPassword=function(e){var t=e.username,n=e.email,o={password:e.password,user:{username:t,email:n}};return this.call("login",o).then(r.onLogin.bind(this))};var r=e("../common/login-method")},{"../common/login-method":8}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.subscribe=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s=(0,u.default)(e,n),c=this.subscriptions.cache.get(s);if(!c){var a=this.ddp.sub(e,n),f="connected"!==this.ddp.status;c=(0,r.default)(new o.default,{fingerprint:s,id:a,name:e,params:n,stillInQueue:f}),this.subscriptions.cache.add(c)}return c},n.unsubscribe=function(e){this.ddp.unsub(e)},n.init=function(){var e=this;this.subscriptions={cache:new i.default},this.ddp.on("ready",function(t){var n=t.subs;n.forEach(function(t){e.subscriptions.cache.get(t).emit("ready")})}).on("nosub",function(t){var n=t.error,r=t.id;n&&e.subscriptions.cache.get(r).emit("error",n),e.subscriptions.cache.del(r)}).on("connected",function(){e.subscriptions.cache.forEach(function(e){e.stillInQueue?e.stillInQueue=!1:(this.ddp.sub(e.name,e.params,e.id),e.stillInQueue="connected"!==this.ddp.status)}.bind(e))})};var r=s(e("lodash.assign")),o=s(e("wolfy87-eventemitter")),i=s(e("../common/subscription-cache")),u=s(e("../common/fingerprint-sub"));function s(e){return e&&e.__esModule?e:{default:e}}},{"../common/fingerprint-sub":7,"../common/subscription-cache":10,"lodash.assign":15,"wolfy87-eventemitter":16}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return JSON.stringify({name:e,params:t})}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.onLogin=function(e){var t=e.id,n=e.token;return this.userId=t,this.loggedIn=!0,r.set(this.endpoint+"__login_token__",n).then(this.emit.bind(this,"loggedIn",t)).then(function(){return t})},n.onLogout=o,n.resumeLogin=function(){return r.get(this.endpoint+"__login_token__").then(function(e){if(!e)throw new Error("No login token");return{resume:e}}).then(this.login.bind(this)).catch(o.bind(this))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./multi-storage"));function o(){return this.userId=null,this.loggedIn=!1,r.del(this.endpoint+"__login_token__").then(this.emit.bind(this,"loggedOut")).then(function(){return null})}},{"./multi-storage":9}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.get=function(e){return new Promise(function(t,n){"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.get(e,function(n){return t(n[e])}):"undefined"!=typeof localStorage?t(localStorage[e]):"undefined"!=typeof AsyncStorage?AsyncStorage.getItem(e,function(e,r){e?n(e):t(r)}):t(r[e])})},n.set=function(e,t){return new Promise(function(n,o){if("undefined"!=typeof chrome&&chrome.storage){var i=function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({},e,t);chrome.storage.local.set(i,n)}else"undefined"!=typeof localStorage?(localStorage[e]=t,n()):"undefined"!=typeof AsyncStorage?AsyncStorage.setItem(e,t,function(e){e?o(e):n()}):(r[e]=t,n())})},n.del=function(e){return new Promise(function(t,n){"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.remove(e,t):"undefined"!=typeof localStorage?(delete localStorage[e],t()):"undefined"!=typeof AsyncStorage?AsyncStorage.removeItem(e,function(e){e?n(e):t()}):(delete r[e],t())})};var r={}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byFingerprint={},this.byId={}}return r(e,[{key:"add",value:function(e){this.byFingerprint[e.fingerprint]=e,this.byId[e.id]=e}},{key:"get",value:function(e){return this.byId[e]||this.byFingerprint[e]||null}},{key:"del",value:function(e){var t=this.get(e)||{};delete this.byFingerprint[t.fingerprint],delete this.byId[t.id]}},{key:"forEach",value:function(e){var t=this;Object.keys(this.byId).forEach(function(n){e(t.byId[n])})}}]),e}();n.default=o},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(e("wolfy87-eventemitter")),i=c(e("./queue")),u=c(e("./socket")),s=e("./utils");function c(e){return e&&e.__esModule?e:{default:e}}var a="1",f=["ready","nosub","added","changed","removed","result","updated","error"],l=1e4,d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.status="disconnected",n.autoConnect=!1!==e.autoConnect,n.autoReconnect=!1!==e.autoReconnect,n.reconnectInterval=e.reconnectInterval||l,n.messageQueue=new i.default(function(e){return"connected"===n.status&&(n.socket.send(e),!0)}),n.socket=new u.default(e.SocketConstructor,e.endpoint),n.socket.on("open",function(){n.socket.send({msg:"connect",version:a,support:[a]})}),n.socket.on("close",function(){n.status="disconnected",n.messageQueue.empty(),n.emit("disconnected"),n.autoReconnect&&setTimeout(n.socket.open.bind(n.socket),n.reconnectInterval)}),n.socket.on("message:in",function(e){"connected"===e.msg?(n.status="connected",n.messageQueue.process(),n.emit("connected")):"ping"===e.msg?n.socket.send({msg:"pong",id:e.id}):(0,s.contains)(f,e.msg)&&n.emit(e.msg,e)}),n.autoConnect&&n.connect(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"emit",value:function(){var e;setTimeout((e=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this)).bind.apply(e,[this].concat(Array.prototype.slice.call(arguments))),0)}}]),r(t,[{key:"connect",value:function(){this.socket.open()}},{key:"disconnect",value:function(){this.autoReconnect=!1,this.socket.close()}},{key:"method",value:function(e,t){var n=(0,s.uniqueId)();return this.messageQueue.push({msg:"method",id:n,method:e,params:t}),n}},{key:"sub",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n||(n=(0,s.uniqueId)()),this.messageQueue.push({msg:"sub",id:n,name:e,params:t}),n}},{key:"unsub",value:function(e){return this.messageQueue.push({msg:"unsub",id:e}),e}}]),t}();n.default=d},{"./queue":12,"./socket":13,"./utils":14,"wolfy87-eventemitter":16}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.consumer=t,this.queue=[]}return r(e,[{key:"push",value:function(e){this.queue.push(e),this.process()}},{key:"process",value:function(){0!==this.queue.length&&(this.consumer(this.queue[0])&&(this.queue.shift(),this.process()))}},{key:"empty",value:function(){this.queue=[]}}]),e}();n.default=o},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("wolfy87-eventemitter"),u=(r=i)&&r.__esModule?r:{default:r};var s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.SocketConstructor=e,r.endpoint=n,r.rawSocket=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),o(t,[{key:"send",value:function(e){var t=JSON.stringify(e);this.rawSocket.send(t),this.emit("message:out",JSON.parse(t))}},{key:"open",value:function(){var e=this;this.rawSocket||(this.rawSocket=new this.SocketConstructor(this.endpoint),this.rawSocket.onopen=function(){return e.emit("open")},this.rawSocket.onclose=function(){e.rawSocket=null,e.emit("close")},this.rawSocket.onerror=function(){delete e.rawSocket.onclose,e.rawSocket.close(),e.rawSocket=null,e.emit("close")},this.rawSocket.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(e){return}e.emit("message:in",n)})}},{key:"close",value:function(){this.rawSocket&&this.rawSocket.close()}}]),t}();n.default=s},{"wolfy87-eventemitter":16}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uniqueId=function(){return(r++).toString()},n.contains=function(e,t){return-1!==e.indexOf(t)};var r=0},{}],15:[function(e,t,n){var r=9007199254740991,o="[object Arguments]",i="[object Function]",u="[object GeneratorFunction]",s=/^(?:0|[1-9]\d*)$/;var c,a,f=Object.prototype,l=f.hasOwnProperty,d=f.toString,h=f.propertyIsEnumerable,p=(c=Object.keys,a=Object,function(e){return c(a(e))}),m=Math.max,v=!h.call({valueOf:1},"valueOf");function g(e,t){var n=O(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&S(e)}(e)&&l.call(e,"callee")&&(!h.call(e,"callee")||d.call(e)==o)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,i=!!r;for(var u in e)!t&&!l.call(e,u)||i&&("length"==u||b(u,r))||n.push(u);return n}function y(e,t,n){var r=e[t];l.call(e,t)&&w(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function b(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||s.test(e))&&e>-1&&e%1==0&&e<t}function _(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||f)}function w(e,t){return e===t||e!=e&&t!=t}var O=Array.isArray;function S(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}(e.length)&&!function(e){var t=E(e)?d.call(e):"";return t==i||t==u}(e)}function E(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var P=function(e){return t=function(t,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,u=o>2?n[2]:void 0;for(i=e.length>3&&"function"==typeof i?(o--,i):void 0,u&&function(e,t,n){if(!E(n))return!1;var r=typeof t;return!!("number"==r?S(n)&&b(t,n.length):"string"==r&&t in n)&&w(n[t],e)}(n[0],n[1],u)&&(i=o<3?void 0:i,o=1),t=Object(t);++r<o;){var s=n[r];s&&e(t,s,r,i)}return t},n=m(void 0===n?t.length-1:n,0),function(){for(var e=arguments,r=-1,o=m(e.length-n,0),i=Array(o);++r<o;)i[r]=e[n+r];r=-1;for(var u=Array(n+1);++r<n;)u[r]=e[r];return u[n]=i,function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(t,this,u)};var t,n}(function(e,t){if(v||_(t)||S(t))!function(e,t,n,r){n||(n={});for(var o=-1,i=t.length;++o<i;){var u=t[o],s=r?r(n[u],e[u],u,n,e):void 0;y(n,u,void 0===s?e[u]:s)}}(t,function(e){return S(e)?g(e):function(e){if(!_(e))return p(e);var t=[];for(var n in Object(e))l.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}(t),e);else for(var n in t)l.call(t,n)&&y(e,n,t[n])});t.exports=P},{}],16:[function(e,t,n){!function(e){"use strict";function n(){}var r=n.prototype,o=e.EventEmitter;function i(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function u(e){return function(){return this[e].apply(this,arguments)}}r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},r.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(e),o="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===i(r[n],t)&&r[n].push(o?t:{listener:t,once:!1});return this},r.on=u("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=u("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var n,r,o=this.getListenersAsObject(e);for(r in o)o.hasOwnProperty(r)&&-1!==(n=i(o[r],t))&&o[r].splice(n,1);return this},r.off=u("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,o,i=e?this.removeListener:this.addListener,u=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)i.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(o=t[r])&&("function"==typeof o?i.call(this,r,o):u.call(this,r,o));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=u("removeEvent"),r.emitEvent=function(e,t){var n,r,o,i,u=this.getListenersAsObject(e);for(i in u)if(u.hasOwnProperty(i))for(n=u[i].slice(0),o=0;o<n.length;o++)!0===(r=n[o]).once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},r.trigger=u("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},r._getEvents=function(){return this._events||(this._events={})},n.noConflict=function(){return e.EventEmitter=o,n},"object"==typeof t&&t.exports?t.exports=n:e.EventEmitter=n}("undefined"!=typeof window?window:this||{})},{}]},{},[1])(1)});